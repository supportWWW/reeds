<% content_for(:browser_title) do %>
	<%=h @new_vehicle.humanize %>
<% end -%>

<% content_for(:title) do %>
	<h2><%=h @new_vehicle.humanize %></h2>
<% end -%>

<% unless @new_vehicle.enabled? %>
	<p style="color: red;">	
		Sorry, it was a great vehicle, but we no longer have it available.<br/>
	</p>

<% else %>

	<div id="action_menu">
		<p>
		<% if (request.env["HTTP_REFERER"] || "").include?(request.env["SERVER_NAME"]) %>
			<%= link_to "Back to search results", "javascript:history.back();", :title => "Back to search results" %>
		<% else %>
			<%= link_to "Search for other new vehicles", search_path(:type => "new_vehicle"), :title => "Search for new motor vehicles" %>
		<% end -%>
		</p>
	</div>

	<div id="twotwenty">

		<%= render :partial => "gallery", :locals => { :new_vehicle => @new_vehicle } %>
		<%= render :partial => "enquiry", :locals => { :new_vehicle => @new_vehicle } %>
	
	</div><!-- end twotwenty -->
	
	<div id="fourthirty">

		<table id="alt" border="0" cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th>Model</th> 
					<th>Mod Ref</th>
					<th>Price <span>(incl. VAT)</span></th>
				</tr>
			</thead>
			<tbody>
				<% @new_vehicle.new_vehicle_variants.each do |new_vehicle_variant| %>
					<tr>
						<td><%=h new_vehicle_variant.name %></td>
						<td><%=h new_vehicle_variant.model_reference %></td>
						<td><%=h new_vehicle_variant.price.format(:no_cents) %></td>
					</tr>
				<% end %>
			</tbody>
		</table>
		
		<% unless @new_vehicle.accessories.empty? %>
			<h6>Accessories:</h6>
			<p><%=h @new_vehicle.accessories.map(&:name).join(", ") %></p>
		<% end %>
		
		<div id="callus">
			<h3>Call us now about this car!</h3>
			<p>If you are excited to get your new car right now, don't hesitate and contact <strong>Suzanne</strong> now on <strong>021 443 5130</strong> and quote the vehicle mod ref.</p>
		</div><!-- end callus -->

		<% unless @new_vehicle.new_vehicle_variants.empty? %>
			<h3>Calculator</h3>
			<%= partial "calculators/monthly_payment", :purchase_price => (@new_vehicle.new_vehicle_variants.first.price_in_cents / 100).to_i %>
		<% end -%>

	</div><!-- end fourthirty -->

<% end -%>

<% content_for(:actions) do %>

	<div id="callback" class="sidebox">
		<h3>Request a Call-back</h3>
		<p>We'll call you back as soon as<br />an agent becomes free.</p>
		<div id="callback_panel">
			<% form_for :form, CallbackForm.new(:vehicle => @new_vehicle.humanize), :url => callback_path, :html => { :method => :post, :id => "callback_form" } do |f| -%>
				<div id="callback_form_notice" class="notice" style="display: none;"></div>
			  <div id="callback_form_errors" class="error" style="display: none;"></div>
				<div>
					Name<br/>
					<%= f.text_field :name %><br/>
					Phone number<br/>
					<%= f.text_field :phone %><br/>
					Branch<br/>
					<%= f.select :branch_id, Branch.find(:all).map { |branch| [branch.name, branch.id] } %><br/>
					<%= f.hidden_field :vehicle %>
					<%= submit_tag 'Call me' %><%= spinner("callback_spinner") %>
				</div>
			<% end -%>
		</div>
	</div>

	<div id="testdrive" class="sidebox">
		<h3>Book a test drive</h3>
		<p><a href="#">Click here</a> to book a test<br />
		drive for this vehicle.</p>
	</div>

	<script type="text/javascript">
	//<![CDATA[

	 $('#callback_form').ajaxForm({
		dataType: 'script',
		beforeSubmit: function(xhr){
			$('#callback_spinner').show();
			$('#callback_form_errors').hide();
			$('#callback_form_notice').hide();
		},
		success: function(data){
			$('#callback_spinner').hide();
			eval(data);
		}
	});
	//]]>
	</script>


<% end -%>
	
